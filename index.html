<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Speech Synthesis Test Program</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    textarea { width: 100%; height: 180px; font-size: 16px; }
    button, select { font-size: 16px; padding: 10px 14px; }
    .row { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .label { font-size: 14px; color: #444; }
  </style>
</head>
<body>
  <h1>Speech Synthesis Test Program</h1>

  <textarea id="t">This is a test program for tts. Please enter any text in this field.</textarea>

  <div class="row">
    <button id="speak">Speak</button>
    <button id="stop">Stop</button>

    <span class="label">Voice:</span>
    <select id="voiceSelect"></select>
  </div>

  <script>
    const voiceSelect = document.getElementById('voiceSelect');

    function isEnglish(v) {
      const lang = (v.lang || '').toLowerCase();
      return lang.startsWith('en');
    }

    function loadVoices() {
      const voices = speechSynthesis.getVoices() || [];

      voiceSelect.innerHTML = '';

      const english = voices.filter(isEnglish);
      const useList = english.length ? english : voices;

      useList.forEach(v => {
        const opt = document.createElement('option');
        opt.textContent = `${v.name} (${v.lang})`;
        opt.dataset.name = v.name;
        opt.dataset.lang = v.lang;
        voiceSelect.appendChild(opt);
      });
    }

    function getSelectedVoice() {
      const voices = speechSynthesis.getVoices() || [];
      const opt = voiceSelect.options[voiceSelect.selectedIndex];
      if (!opt) return null;

      const name = opt.dataset.name;
      const lang = opt.dataset.lang;

      return voices.find(v => v.name === name && v.lang === lang) || null;
    }

    function speak() {
      const text = document.getElementById('t').value.trim();
      if (!text) return;

      speechSynthesis.cancel();

      const u = new SpeechSynthesisUtterance(text);
      const v = getSelectedVoice();

      if (v) {
        u.voice = v;
        u.lang = v.lang || "en-US";
      } else {
        u.lang = "en-US";
      }

      speechSynthesis.speak(u);
    }

    document.getElementById('speak').addEventListener('click', speak);
    document.getElementById('stop').addEventListener('click', () => speechSynthesis.cancel());

    window.speechSynthesis.onvoiceschanged = () => loadVoices();

    loadVoices();
    setTimeout(loadVoices, 500);
    setTimeout(loadVoices, 1500);
  </script>
</body>
</html>
